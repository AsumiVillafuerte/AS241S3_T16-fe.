<div class="container-general">

  <!-- Encabezado -->
  <div class="container">
    <h1>Gestión de Empleados de Limpieza</h1>
    <p>Administre los empleados de limpieza del hotel</p>
  </div>

  <!-- Barra superior -->
  <div class="top-bar">
    <div class="tab-buttons">
      <a routerLink="/Employee" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" class="btn">
        Lista de Empleados
      </a>
      <a routerLink="/new-employee" routerLinkActive="active" class="btn">
        Nuevo Empleado
      </a>
    </div>

    <div class="search-container">
      <i class="fas fa-search icon"></i>
      <input type="text" [(ngModel)]="searchTerm" (input)="filterEmployees()" placeholder="Buscar...">
    </div>

    <button class="pdf-button" (click)="reportPdf()">
      <i class="fas fa-file-pdf"></i> Generar PDF
    </button>

    <!-- Menú desplegable -->
    <div class="dropdown-container">
      <button class="filter-button" (click)="toggleFilterDropdown()">
        <i class="fas fa-filter icon1"></i>
      </button>

      @if (showFilterDropdown) {
        <div class="filter-dropdown">
          <button (click)="filterByState('Todos')">Todos</button>
          <button (click)="filterByState('Activo')">Activo</button>
          <button (click)="filterByState('Inactivo')">Inactivo</button>
        </div>
      }
    </div>

    <!-- ✅ corregido: antes era <button><a></a></button> -->
    <a class="new-button" routerLink="/new-employee">
      <i class="fas fa-plus icon2"></i> Nuevo Empleado
    </a>
  </div>

  <!-- Tabla de empleados -->
  <div class="contenedor-empleados">
    <h3>Empleados de Limpieza</h3>
    <p>Gestione los empleados de limpieza del hotel. Puede ver, editar o eliminar empleados existentes.</p>

    <table class="table table-striped table-bordered">
      <thead class="table-dark text-center">
        <tr>
          <th>Nombres</th>
          <th>Apellidos</th>
          <th>Teléfono</th>
          <th>Tipo Doc.</th>
          <th>N° Documento</th>
          <th>Turno</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody class="text-center">
        @for (employee of dataSource.slice((currentPage - 1) * pageSize, currentPage * pageSize); track employee) {
          <tr>
            <td>{{ employee.names }}</td>
            <td>{{ employee.surnames }}</td>
            <td>{{ employee.phone }}</td>
            <td>{{ employee.document_type }}</td>
            <td>{{ employee.document_number }}</td>
            <td>{{ employee.shift.split('(')[0] }}</td>
            <td>
              <span [ngClass]="employee.state === 'A' ? 'badge-active' : 'badge-inactive'">
                {{ employee.state === 'A' ? 'Activo' : 'Inactivo' }}
              </span>
            </td>
            <td>
              <!-- Ver siempre habilitado -->
              <button class="action-button" (click)="viewEmployee(employee.id_employee!)">
                <i class="fas fa-eye"></i>
              </button>

              <!-- Editar y Eliminar solo si está activo -->
              @if (employee.state === 'A') {
                <button class="action-button" (click)="editEmployee(employee.id_employee!)">
                  <i class="fas fa-pencil-alt"></i>
                </button>
                <button class="action-button" (click)="deleteEmployee(employee.id_employee!)">
                  <i class="fas fa-trash-alt"></i>
                </button>
              }

              <!-- Restaurar solo si está inactivo -->
              @if (employee.state === 'I') {
                <button class="action-button" (click)="restoreEmployee(employee.id_employee!)">
                  <i class="fas fa-undo"></i>
                </button>
              }
            </td>
          </tr>
        }
      </tbody>
    </table>

    <!-- Paginación -->
    <div class="pagination-container">
      <div class="pagination">
        <button (click)="previousPage()" [disabled]="currentPage === 1">Anterior</button>
        <span class="info">Página {{ currentPage }} de {{ totalPages }}</span>
        <button (click)="nextPage()" [disabled]="currentPage === totalPages">Siguiente</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de edición -->
@if (showEditModal) {
  <app-employee-edit-modal
    [employee]="selectedEmployee"
    (employeeUpdated)="onEmployeeUpdated($event)"
    (closeModal)="cancelEdit()"
    class="modal-container">
  </app-employee-edit-modal>
}

<!-- Modal de vista -->
@if (showViewModal) {
  <app-employee-view-modal
    [employee]="selectedEmployee!"
    (close)="cancelView()">
  </app-employee-view-modal>
}
